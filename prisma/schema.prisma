// Natlaupa Database Schema
// Neon PostgreSQL with Prisma ORM

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// HOTEL & TRAVEL DATA MODELS
// ============================================

model Hotel {
  id            String   @id @default(cuid())
  name          String
  location      String
  country       String
  category      String
  rating        Float
  imageUrl      String
  isTrending    Boolean  @default(false)
  description   String?
  ctaPhrase     String?
  lat           Float?
  lng           Float?
  amenities     String[]
  galleryImages String[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  reviews       Review[]
  moodTags      HotelMoodTag[]

  @@index([country])
  @@index([category])
  @@index([isTrending])
}

model Review {
  id        String   @id @default(cuid())
  user      String
  rating    Int
  comment   String
  date      String
  hotelId   String
  hotel     Hotel    @relation(fields: [hotelId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@index([hotelId])
}

model Destination {
  id          String  @id @default(cuid())
  name        String
  country     String
  imageUrl    String
  temp        Int
  lat         Float?
  lng         Float?
  description String
}

model Category {
  id       String @id @default(cuid())
  name     String @unique
  imageUrl String
  count    Int
}

// ============================================
// CONTACT FORM SUBMISSIONS
// ============================================

// General contact form submissions
model ContactSubmission {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String?
  message   String
  status    String   @default("new") // new, read, replied, archived
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status])
  @@index([createdAt])
}

// Hotel/Concierge inquiry submissions (from offer pages)
model HotelInquiry {
  id        String   @id @default(cuid())
  hotelId   String
  hotelName String
  name      String
  email     String
  phone     String?
  message   String
  status    String   @default("new") // new, contacted, booked, closed
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([hotelId])
  @@index([status])
  @@index([createdAt])
}

// Hotel partnership applications (from /for-hotels)
model PartnershipApplication {
  id          String   @id @default(cuid())
  firstName   String
  lastName    String
  email       String
  phone       String?
  companyName String
  message     String
  status      String   @default("pending") // pending, reviewing, approved, rejected
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([status])
  @@index([createdAt])
}

// Angel program applications (from /become-angel)
model AngelApplication {
  id                  String   @id @default(cuid())
  firstName           String
  lastName            String
  email               String
  phone               String
  currentPosition     String
  yearsInHospitality  String
  motivation          String
  status              String   @default("pending") // pending, reviewing, approved, rejected
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@index([status])
  @@index([createdAt])
}

// ============================================
// MOOD MATCHING & RECOMMENDATIONS
// ============================================

// Mood types for categorizing hotels
model MoodTag {
  id        String         @id @default(cuid())
  name      String         @unique // romantic, adventure, cultural, wellness
  label     String         // Display label: "Romantic Escape", "Adventure Seeker", etc.
  icon      String?        // Icon name for UI
  color     String?        // Color gradient for UI
  hotels    HotelMoodTag[]
}

// Many-to-many relationship between hotels and moods
model HotelMoodTag {
  id        String   @id @default(cuid())
  hotelId   String
  moodId    String
  weight    Float    @default(1.0) // 0-1 relevance score
  hotel     Hotel    @relation(fields: [hotelId], references: [id], onDelete: Cascade)
  mood      MoodTag  @relation(fields: [moodId], references: [id], onDelete: Cascade)

  @@unique([hotelId, moodId])
  @@index([hotelId])
  @@index([moodId])
}

// ============================================
// USER TRACKING & PREFERENCES
// ============================================

// User accounts (optional - for hybrid tracking)
model User {
  id            String           @id @default(cuid())
  email         String?          @unique
  name          String?
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  preferences   UserPreference[]
  interactions  UserInteraction[]
}

// User mood preferences (learned from interactions)
model UserPreference {
  id        String   @id @default(cuid())
  userId    String
  moodId    String
  score     Float    @default(0) // preference strength (0-1)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  updatedAt DateTime @updatedAt

  @@unique([userId, moodId])
  @@index([userId])
}

// User interaction tracking
model UserInteraction {
  id          String   @id @default(cuid())
  userId      String?  // null for anonymous users
  sessionId   String   // for anonymous tracking
  hotelId     String
  action      String   // view, click, inquiry, bookmark
  moodContext String?  // mood selected when interaction happened
  createdAt   DateTime @default(now())
  user        User?    @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([sessionId])
  @@index([hotelId])
  @@index([action])
  @@index([createdAt])
}

// ============================================
// COOKIE CONSENT & PRIVACY
// ============================================

// Cookie consent tracking
model CookieConsent {
  id              String   @id @default(cuid())
  sessionId       String   @unique
  essential       Boolean  @default(true)  // always true
  analytics       Boolean  @default(false)
  personalization Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([sessionId])
}
